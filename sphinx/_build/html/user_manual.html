

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>User manual &mdash; Cnerator latest documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cnerator API" href="modules.html" />
    <link rel="prev" title="Getting started" href="getting_started.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cnerator
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#command-line-arguments">Command line arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#syntactic-constructs">Syntactic constructs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#probability-specification-files">Probability specification files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#function-generation-files">Function generation files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#post-processing-specification-files">Post-processing specification files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Cnerator API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cnerator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>User manual</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-manual">
<h1>User manual<a class="headerlink" href="#user-manual" title="Permalink to this headline">¶</a></h1>
<p>This text describes how to use Cnerator for the stochastic generation of compilable C source code.</p>
<div class="section" id="command-line-arguments">
<h2>Command line arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h2>
<p>These are the command line arguments provided by <a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a>
(all of them are optional):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">NAME</span></code> or <code class="docutils literal notranslate"><span class="pre">--output</span> <span class="pre">NAME</span></code>: <code class="docutils literal notranslate"><span class="pre">NAME</span></code> indicates the output file name, without the file extension.
The default value is <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-O</span> <span class="pre">PATH</span></code> or <code class="docutils literal notranslate"><span class="pre">--output_dir</span> <span class="pre">PATH</span></code>: <code class="docutils literal notranslate"><span class="pre">PATH</span></code> is the output directory where the C source code
is placed. If the directory does not exist, it is created. The default value is <code class="docutils literal notranslate"><span class="pre">out</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">NUMBER</span></code> or <code class="docutils literal notranslate"><span class="pre">--nfiles</span> <span class="pre">NUMBER</span></code>: Generates the output program in <code class="docutils literal notranslate"><span class="pre">NUMBER</span></code> compilation units.
Each compilation unit is a pair of <code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.h</span></code> files.
A compilation unit can be compiled independently,
even though they commonly depend on other compilation units.
The default value is 2.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">RECURSION_LIMIT</span></code> or <code class="docutils literal notranslate"><span class="pre">--recursion</span> <span class="pre">RECURSION_LIMIT</span></code>: Defines the maximum number of
Python recursive invocations. This parameter may be modified when massive codebases
are being modified, checking that the runtime environment provides sufficient memory.
The default value is 50000.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-v</span></code> or <code class="docutils literal notranslate"><span class="pre">--verbose</span></code>: Enables the verbose mode to show runtime messages.
By default, the verbose mode is disabled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-d</span></code> or <code class="docutils literal notranslate"><span class="pre">--debug</span></code>: Generates debug information, comprising call graphs and struct structures
in <code class="docutils literal notranslate"><span class="pre">.dot</span></code> files.
By default, the debug option is disabled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">PROBS</span></code> or <code class="docutils literal notranslate"><span class="pre">--probs</span> <span class="pre">PROBS</span></code>: <code class="docutils literal notranslate"><span class="pre">PROBS</span></code> represents a semicolon-separated list of probabilities
and their values for different syntactic constructs.
An example use is <code class="docutils literal notranslate"><span class="pre">&quot;call_prob={True:0.2,False:0.8};</span> <span class="pre">param_number_prob={0:0.2,1:0.3,2:0.3,3:0.2}&quot;</span></code>.
To know all the different syntactic constructs provided
by <a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a>, please check the
[syntactic constructs](#syntactic-constructs) section.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">PROBSFILE</span></code> or <code class="docutils literal notranslate"><span class="pre">--probsfile</span> <span class="pre">PROBSFILE</span></code>: <code class="docutils literal notranslate"><span class="pre">PROBSFILE</span></code> is a JSON file specifying some probabilities
for different language constructs. Different examples are provided in the <code class="docutils literal notranslate"><span class="pre">json/probabilities</span></code>
directory.
The structure of <code class="docutils literal notranslate"><span class="pre">PROBSFILE</span></code> JSON files is described in the
[probability specification files](#probability-specification-files) section.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">FUNCTIONS</span></code> or <code class="docutils literal notranslate"><span class="pre">--functions</span> <span class="pre">FUNCTIONS</span></code>: <code class="docutils literal notranslate"><span class="pre">FUNCTIONS</span></code> is a JSON file specifying conditions
of the functions to be created by <a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a>.
The user can express properties that the
generated functions will fulfill.
Different example files are provided in the <code class="docutils literal notranslate"><span class="pre">json/functions</span></code> directory.
The structure of <code class="docutils literal notranslate"><span class="pre">FUNCTIONS</span></code> JSON files is described in the
[function generation files](#function-generation-files) section.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-V</span> <span class="pre">VISITORS</span></code> or <code class="docutils literal notranslate"><span class="pre">--visitors</span> <span class="pre">VISITORS</span></code>: An ordered colon-separated list of visitors to
adapt, process or modify the program representation generated
by <a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a>.
Once the visitors are run, <a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a>
takes the final program representation and
generates the final C source code.
An example value of <code class="docutils literal notranslate"><span class="pre">VISITORS</span></code> is <code class="docutils literal notranslate"><span class="pre">visitors.func_to_proc:visitors.return_instrumentation</span></code>.
The <code class="docutils literal notranslate"><span class="pre">visitors</span></code> directory provides different examples of visitor implementations.
A brief description of how to implement of such visitors is presented in the
[post-processing specification files](#post-processing-specification-files) section.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-h</span></code> or <code class="docutils literal notranslate"><span class="pre">--help</span></code>: Shows a description of the command line arguments, including the default values.</p></li>
</ul>
</div>
<div class="section" id="syntactic-constructs">
<h2>Syntactic constructs<a class="headerlink" href="#syntactic-constructs" title="Permalink to this headline">¶</a></h2>
<p>As mentioned, <a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a> allows defining
the probabilities of different syntactic constructs of
the C programming language. What follows is a description of all the constructs and their
unique identifiers, when the <code class="docutils literal notranslate"><span class="pre">-p</span></code> or <code class="docutils literal notranslate"><span class="pre">-P</span></code> options are used:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">primitive_types_prob</span></code>: probabilities among primitive types (default: equal
probability for all the types).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">assignment_types_prob</span></code>: assignment type (default: equal probability for all
the types).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">augmented_assignment_types_prob</span></code>: augmented assignment type (<code class="docutils literal notranslate"><span class="pre">+=</span></code>, <code class="docutils literal notranslate"><span class="pre">-=</span></code>, <code class="docutils literal notranslate"><span class="pre">*=</span></code>, etc.)
(default: equal probability for primitive types).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">all_types_prob</span></code>: type probability when any type may occur in a syntax
construction (default: equal probability for any type).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">array_size</span></code>: size of the arrays to be created (default: 1-10).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reuse_struct_prob</span></code>: when a struct is needed, probability of using and
existing one rather than creating a new one (default: 90%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enhance_existing_struct_prob</span></code>: when a struct is needed, probability of
extending an existing one with the demanded field rather than creating a new
one (default: 70%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">array_literal_initialization_prob</span></code>: array initialization upon definition
(default: 10%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">struct_literal_initialization_prob</span></code>: struct initialization upon definition
(default: 10%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exp_depth_prob</span></code>: expression depth (default: equal probabilities for [0-2]).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_exp_depth_prob</span></code>: expression depth for the particular expressions to
be returned by functions (default: equal probabilities for [0-2]).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">call_prob</span></code>: probability that a new expression is a function invocation
(default: 20%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basic_expression_prob</span></code>: basic expressions (default: same probability among
literal, local variable, global variable, and param variable).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">param_number_prob</span></code>: number of parameters (default: 10% for 1, 20% for [1,4]
and 5% for [5,6]).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">param_types_prob</span></code>: types of the parameters (default: all types are equally
likely).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stmt_invocation_prob</span></code>: invocation statements to functions or procedures
(default: function=88%, procedure=12%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_types_prob</span></code>: function return types (default: all types are equally
likely).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int_emulate_bool</span></code>: probability of generating a bool return (0 or 1) when an
int type is expected (default: 20%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_global_var_prob</span></code>: probability of creating a new global variable when one
of the expected types already exists (default: 1%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_local_var_prob</span></code>: probability of creating a new local variable when one
of the expected types already exists (default: 1%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reuse_func_prob</span></code>: probability of reusing an existing function of the
expected type (default: 99%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reuse_proc_prob</span></code>: probability of reusing an existing procedure of the
expected type (default: 99%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">global_or_local_as_basic_lvalue_prob</span></code>: When a basic l-value needs to be
generated, this is the probability of using a global variable; otherwise, a
local variable is used (default: 50%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basic_or_compound_stmt_prob</span></code>: probability of generating a basic (no block)
or compound statement (default: basic=70%, compound=30%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">function_basic_stmt_prob</span></code>: each kind of basic (no block) statement in
functions (default: assignment=60%, invocation=20%, increment/decrement=20%,
augmented assignment=10%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">function_compound_stmt_prob</span></code>: each kind of compound statement (with blocks)
in functions (equal probability for Block, If, Switch, Do, While, For).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stmt_depth_prob</span></code>: statement depth (default: equal probabilities for [0-2]).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">procedure_basic_stmt_prob</span></code>: each kind of basic (no block) statement in
functions (default: assignment=60%, invocation=20%, increment/decrement=20%,
augmented assignment=10%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">procedure_compound_stmt_prob</span></code>: each kind of compound statement (with blocks)
in functions (equal probability for Block, If, Switch, Do, While, For).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number_stmts_main_prob</span></code>: number of statements in the main function (default:
equal probabilities between 5 and 10).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number_stmts_func_prob</span></code>: number of statements in functions (default: 20% for
[1,4] and 10% for [5, 6]).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number_stmts_block_prob</span></code>: number of statements in blocks (default: 1/3 for 1, 2
and 3).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">else_body_prob</span></code>: probability of generating an else body for an if statement
(default: 50%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number_cases_prob</span></code>: number of cases in switch statements (default: equal
probabilities between 1 and 4).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cases_type_prob</span></code>: type of the cases clauses in switch statements (default:
equal probabilities between types promotable to int, excluding bool).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_switch_prob</span></code>: probability of generating a default case in a switch
statement (default: 80%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">break_case_prob</span></code>: probability of having a break statement at the end of a
case block (default: 70%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_at_end_if_else_bodies_prob</span></code>: probability of having a return at the
end of an if / else blocks (default: 15%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_at_end_case_prob</span></code>: probability of having a return at the end of the
cases clauses in a switch statement (default: 15%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">implicit_promotion_bool</span></code>: if an expression is expected, the probability to
generate it with another type promotable to the expected one (default: 30%).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">promotions_prob</span></code>: promotions between types (default: all the conversions are
equally likely).</p></li>
</ul>
</div>
<div class="section" id="probability-specification-files">
<h2>Probability specification files<a class="headerlink" href="#probability-specification-files" title="Permalink to this headline">¶</a></h2>
<p>Probability specification files are JSON documents that the user can use to define
the probability of different [syntactic constructs](#syntactic-constructs).
The following JSON file shows an example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;function_basic_stmt_prob&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;assignment&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
      <span class="nt">&quot;invocation&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
      <span class="nt">&quot;augmented_assignment&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
      <span class="nt">&quot;incdec&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
      <span class="nt">&quot;expression_stmt&quot;</span><span class="p">:</span> <span class="mf">0.05</span>
   <span class="p">},</span>
   <span class="nt">&quot;array_literal_initialization_prob&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;True&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="nt">&quot;False&quot;</span><span class="p">:</span> <span class="mf">0.9</span>
   <span class="p">},</span>
   <span class="nt">&quot;primitive_types_prob&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;__prob_distribution__&quot;</span><span class="p">:</span> <span class="s2">&quot;equal_prob&quot;</span><span class="p">,</span>
      <span class="nt">&quot;__values__&quot;</span><span class="p">:</span> <span class="p">[</span>
         <span class="s2">&quot;ast.Bool&quot;</span><span class="p">,</span>
         <span class="s2">&quot;ast.SignedChar&quot;</span><span class="p">,</span>
         <span class="s2">&quot;ast.UnsignedChar&quot;</span><span class="p">,</span>
         <span class="s2">&quot;ast.SignedShortInt&quot;</span>
      <span class="p">]</span>
   <span class="p">},</span>
   <span class="nt">&quot;param_number_prob&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;__prob_distribution__&quot;</span><span class="p">:</span> <span class="s2">&quot;proportional_prob&quot;</span><span class="p">,</span>
      <span class="nt">&quot;__values__&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="nt">&quot;0&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&quot;1&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nt">&quot;2&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
         <span class="nt">&quot;3&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nt">&quot;4&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nt">&quot;5&quot;</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">}</span>
   <span class="p">},</span>
   <span class="nt">&quot;number_stmts_main_prob&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;__prob_distribution__&quot;</span><span class="p">:</span> <span class="s2">&quot;normal_prob&quot;</span><span class="p">,</span>
      <span class="nt">&quot;__mean__&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
      <span class="nt">&quot;__stdev__&quot;</span><span class="p">:</span> <span class="mi">3</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first entry (<code class="docutils literal notranslate"><span class="pre">function_basic_stmt_prob</span></code>) defines the probability of building basic statements
(i.e., statements not containing other statements, unlike <code class="docutils literal notranslate"><span class="pre">for</span></code> and <code class="docutils literal notranslate"><span class="pre">switch</span></code>),
and the second one (<code class="docutils literal notranslate"><span class="pre">array_literal_initialization_prob</span></code>) states when an array definition should initialize their values.
These two examples specify fixed probabilities that must sum zero.
The three remaining entries describe uniform/equal, proportional and normal distributions to define, respectively,
the usage of primitive types (<code class="docutils literal notranslate"><span class="pre">primitive_types_prob</span></code>),
the number of function parameters (<code class="docutils literal notranslate"><span class="pre">param_number_prob</span></code>)
and statements in the <code class="docutils literal notranslate"><span class="pre">main</span></code> function (<code class="docutils literal notranslate"><span class="pre">number_stmts_main_prob</span></code>).</p>
</div>
<div class="section" id="function-generation-files">
<h2>Function generation files<a class="headerlink" href="#function-generation-files" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a> provides the capability of
specifying features to be fulfilled by the generated functions.
The following JSON file shows an example use of such capacity:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;function_returning_void&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda f: isinstance(f.return_type, ast.Void)&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;function_returning_bool&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda f: isinstance(f.return_type, ast.Bool)&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;function_with_if_else&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda f: any(stmt for stmt in f.children if isinstance(stmt, ast.If) and any(stmt.else_statements))&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The two first entries (<code class="docutils literal notranslate"><span class="pre">function_returning_void</span></code> and <code class="docutils literal notranslate"><span class="pre">function_returning_bool</span></code>)
enforce <a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a> to generate 1000
functions returning <code class="docutils literal notranslate"><span class="pre">void</span></code> and the same
number of functions returning <code class="docutils literal notranslate"><span class="pre">bool</span></code>. The only condition in the lambda expressions
checks that the returned type is the expected one.
The last entry (<code class="docutils literal notranslate"><span class="pre">function_with_if_else</span></code>) shows a different example,
where the user demands <a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a>
to generate a function containing an <code class="docutils literal notranslate"><span class="pre">if</span></code> statement with an <code class="docutils literal notranslate"><span class="pre">else</span></code> clause.</p>
</div>
<div class="section" id="post-processing-specification-files">
<h2>Post-processing specification files<a class="headerlink" href="#post-processing-specification-files" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/ComputationalReflection/Cnerator">Cnerator</a> provides a mechanism
to process / modify program representation before the final
source code generalization. The following code shows an example Python post-process specification file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">singledispatch</span>
<span class="kn">from</span> <span class="nn">cnerator</span> <span class="kn">import</span> <span class="n">ast</span>

<span class="k">def</span> <span class="nf">_instrument_statements</span><span class="p">(</span><span class="n">statements</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">ASTNode</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">ASTNode</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Includes a unique label before any return statement&quot;&quot;&quot;</span>
    <span class="n">instrumented_stmts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">statements</span><span class="p">:</span>                          <span class="c1"># iterates through the statements</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">):</span>             <span class="c1"># if the statement is return…</span>
            <span class="n">label_ast</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">generate_label</span><span class="p">())</span>  <span class="c1"># creates a new AST node for the label</span>
            <span class="n">instrumented_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_ast</span><span class="p">)</span>     <span class="c1"># and places the label before the return</span>
            <span class="n">visit</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>                              <span class="c1"># traverses the statement</span>
            <span class="n">instrumented_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>          <span class="c1"># appends return after the label</span>
    <span class="k">return</span> <span class="n">instrumented_stmts</span>

<span class="nd">@visit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Function</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Traverses a function definition to add a unique label before each return statement&quot;&quot;&quot;</span>
    <span class="n">function</span><span class="o">.</span><span class="n">stmts</span> <span class="o">=</span> <span class="n">_instrument_statements</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">stmts</span><span class="p">)</span>

<span class="nd">@visit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Do</span><span class="p">)</span>
<span class="nd">@visit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">)</span>
<span class="nd">@visit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">)</span>
<span class="nd">@visit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Block</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Traverses a control flow statement to add a unique label before each return statement&quot;&quot;&quot;</span>
    <span class="n">node</span><span class="o">.</span><span class="n">statements</span> <span class="o">=</span> <span class="n">_instrument_statements</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">statements</span><span class="p">)</span>

<span class="n">_return_label_counter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">generate_label</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Generates a new unique label string&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_return_label_counter</span>
    <span class="n">_return_label_counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;__RETURN</span><span class="si">{</span><span class="n">_return_label_counter</span><span class="si">}</span><span class="s2">__&quot;</span>

<span class="o">...</span>
</pre></div>
</div>
<p>The previous code traverses the representation of the generated program (i.e., its Abstract Syntax Tree (AST)),
and adds a unique label before each <code class="docutils literal notranslate"><span class="pre">return</span></code> statement.
The <code class="docutils literal notranslate"><span class="pre">_instrument_statements</span> <span class="pre">function</span></code> takes a list of statements (represented as
AST nodes) and adds a unique label —prefixed with <code class="docutils literal notranslate"><span class="pre">__RETURN__</span></code>– before each <code class="docutils literal notranslate"><span class="pre">return</span></code> statement.
This is later used in the traversal of function definitions (<code class="docutils literal notranslate"><span class="pre">ast.Function</span></code>),
and <code class="docutils literal notranslate"><span class="pre">do</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>, <code class="docutils literal notranslate"><span class="pre">for</span></code> and block statements
–<code class="docutils literal notranslate"><span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">switch</span></code> control flow statements follow the same template.
This instrumentation technique was used to associate
fragments of binary code with their corresponding high-level <code class="docutils literal notranslate"><span class="pre">return</span></code> statements.</p>
<p>The previous code is an instance of an introspective implementation of the _Visitor_ design pattern.
The <code class="docutils literal notranslate"><span class="pre">visit</span></code> annotations indicate the AST node to be traversed.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="modules.html" class="btn btn-neutral float-right" title="Cnerator API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="getting_started.html" class="btn btn-neutral float-left" title="Getting started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Francisco Ortin and Javier Escalada.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>